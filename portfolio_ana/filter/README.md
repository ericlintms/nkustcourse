# 財務資料欄位過濾程式說明

## 目的

本程式 (`filter_fin_llm.py`) 用於從完整的財務資料檔案中篩選出選股分析和 LLM 分析所需的關鍵欄位，以減少資料檔案大小，同時保留所有必要的財務資訊。

## 使用方式

```bash
python filter/filter_fin_llm.py
```

## 輸入/輸出

- **輸入檔案**：`data/financial_data_full_cleaned.csv` (70MB, 283 欄位)
- **輸出檔案**：`data/filtered_data.csv` (17MB, 47 欄位)
- **檔案大小減少**：約 88.5%

## 保留的欄位清單

### 1. 基本識別欄位 (5 個)
- 公司 - 公司代碼
- 簡稱 - 公司簡稱
- 年/月 - 財報期間
- 季別 - 季別
- 合併(Y/N) - 是否為合併報表

### 2. 選股程式必需欄位 (6 個)
這些欄位由 `stock_screener.py` 直接使用：
- **每股盈餘** - 用於獲利能力篩選 (EPS > 1)
- **流動資產** - 用於計算流動比率
- **流動負債** - 用於計算流動比率
- **每股淨值(B)** - 用於公司體質篩選 (> 10)
- **營業利益** - 用於計算營業利益率
- **營業收入淨額** - 用於計算營業利益率

### 3. 資產負債表關鍵欄位 (8 個)
- 資產總額 - 總資產規模
- 負債總額 - 總負債
- 股東權益總額 - 淨值
- 現金及約當現金 - 現金部位
- 存貨 - 存貨水準
- 應收帳款及票據 - 應收帳款
- 短期借款 - 短期負債
- 普通股股本 - 股本

### 4. 損益表關鍵欄位 (6 個)
- 營業成本 - 成本結構
- 營業毛利 - 毛利
- 營業費用 - 營業費用
- 稅前淨利 - 稅前盈餘
- 所得稅費用 - 所得稅
- 合併總損益 - 淨利（稅後）

### 5. 現金流量表關鍵欄位 (3 個)
- 來自營運之現金流量 - 營業現金流
- 投資活動之現金流量 - 投資現金流
- 籌資活動之現金流量 - 融資現金流

### 6. 財務比率關鍵欄位 (8 個)
- ROE(A)－稅後 - 股東權益報酬率
- ROA(A)稅後息前 - 資產報酬率
- 負債比率 - 負債比率
- 速動比率 - 速動比率
- 營業毛利率 - 毛利率
- 營業利益率 - 營業利益率
- 稅後淨利率 - 淨利率
- 流動比率 - 流動比率

### 7. 每股相關指標 (4 個)
- 每股現金流量 - 每股營業現金流
- 每股營業額 - 每股營收
- 每股營業利益 - 每股營業利益
- 每股稅前淨利 - 每股稅前盈餘

### 8. 成長性指標 (4 個)
- 營收成長率 - 營收成長率
- 營業利益成長率 - 營業利益成長率
- 稅後淨利成長率 - 淨利成長率
- 總資產成長率 - 資產成長率

### 9. 產業與市場分類 (3 個)
- 市場別 - 上市/上櫃
- TEJ主產業代碼 - 產業分類
- TEJ子產業代碼 - 子產業分類

## 欄位選擇原則

1. **必需性**：保留 `stock_screener.py` 和 `llm_analyzer.py` 直接使用的欄位
2. **完整性**：涵蓋財務三大報表（資產負債表、損益表、現金流量表）的核心指標
3. **專業性**：包含專業財務分析常用的比率和指標
4. **成長性**：保留反映公司成長動能的指標
5. **分類性**：保留產業分類資訊，便於同業比較

## 與現有程式的相容性

此過濾程式生成的 `filtered_data.csv` 完全相容於：
- ✅ `stock_screener.py` - 所有選股所需欄位均已保留
- ✅ `llm_analyzer.py` - 所有 LLM 分析所需欄位均已保留

## 效益

- **空間節省**：從 70MB 降至 17MB，節省約 76%的磁碟空間
- **記憶體節省**：從 377.87 MB 降至 43.60 MB，節省約 88.5%的記憶體使用
- **處理速度**：較小的資料集可加快讀取和處理速度
- **維護性**：保留的 47 個欄位涵蓋完整的財務分析需求

## 注意事項

1. 本程式假設輸入檔案已經過 `clean_full_data.py` 清理
2. 輸出檔案使用 UTF-8-BOM 編碼，確保中文正確顯示
3. 如需新增欄位，請修改程式中的欄位清單並重新執行
4. 建議定期重新執行此程式以同步最新的完整資料

## 更新日期

2025年11月10日
